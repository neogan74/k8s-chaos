---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.18.0
  name: chaosexperiments.chaos.gushchin.dev
spec:
  group: chaos.gushchin.dev
  names:
    kind: ChaosExperiment
    listKind: ChaosExperimentList
    plural: chaosexperiments
    singular: chaosexperiment
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .spec.action
      name: Action
      type: string
    - jsonPath: .spec.namespace
      name: Namespace
      type: string
    - jsonPath: .spec.count
      name: Count
      type: integer
    - jsonPath: .status.phase
      name: Phase
      type: string
    - jsonPath: .status.retryCount
      name: Retries
      type: integer
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: ChaosExperiment is the Schema for the chaosexperiments API
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: spec defines the desired state of ChaosExperiment
            properties:
              action:
                description: Action specifies the chaos action to perform
                enum:
                - pod-kill
                - pod-delay
                - node-drain
                - pod-cpu-stress
                - pod-memory-stress
                - pod-failure
                - pod-network-loss
                type: string
              allowProduction:
                default: false
                description: |-
                  AllowProduction explicitly allows experiments in production namespaces
                  Production namespaces are identified by annotations or labels (environment=production, env=prod)
                type: boolean
              count:
                default: 1
                description: Count specifies the number of resources to affect
                maximum: 100
                minimum: 1
                type: integer
              cpuLoad:
                description: CPULoad specifies the percentage of CPU to consume (for
                  pod-cpu-stress)
                maximum: 100
                minimum: 1
                type: integer
              cpuWorkers:
                default: 1
                description: CPUWorkers specifies the number of CPU workers (for pod-cpu-stress)
                maximum: 32
                minimum: 1
                type: integer
              dryRun:
                default: false
                description: |-
                  DryRun mode previews affected resources without executing chaos
                  When enabled, the controller lists resources that would be affected and updates status without performing actions
                type: boolean
              duration:
                description: Duration specifies how long the chaos action should last
                  (for pod-delay)
                pattern: ^([0-9]+(s|m|h))+$
                type: string
              experimentDuration:
                description: |-
                  ExperimentDuration specifies how long the entire experiment should run before auto-stopping
                  If not set, the experiment runs indefinitely until manually stopped
                pattern: ^([0-9]+(s|m|h))+$
                type: string
              lossCorrelation:
                default: 0
                description: |-
                  LossCorrelation specifies correlation for packet loss (for pod-network-loss)
                  Higher values make losses cluster together. Range: 0-100.
                maximum: 100
                minimum: 0
                type: integer
              lossPercentage:
                default: 5
                description: |-
                  LossPercentage specifies the packet loss percentage (for pod-network-loss)
                  Range: 1-40. Percentage of packets to drop.
                maximum: 40
                minimum: 1
                type: integer
              maxPercentage:
                description: |-
                  MaxPercentage limits the percentage of matching resources that can be affected
                  If count would affect more than this percentage, the experiment fails validation
                  Range: 1-100. If not specified, no percentage limit is enforced.
                maximum: 100
                minimum: 1
                type: integer
              maxRetries:
                default: 3
                description: MaxRetries specifies the maximum number of retry attempts
                  for failed experiments
                maximum: 10
                minimum: 0
                type: integer
              memorySize:
                description: |-
                  MemorySize specifies the amount of memory to consume per worker (for pod-memory-stress)
                  Format: number followed by M (megabytes) or G (gigabytes)
                  Examples: "256M", "512M", "1G", "2G"
                pattern: ^[0-9]+[MG]$
                type: string
              memoryWorkers:
                default: 1
                description: |-
                  MemoryWorkers specifies the number of memory workers (for pod-memory-stress)
                  Total memory consumed = memorySize * memoryWorkers
                maximum: 8
                minimum: 1
                type: integer
              namespace:
                description: Namespace specifies the target namespace for chaos experiments
                minLength: 1
                type: string
              retryBackoff:
                default: exponential
                description: RetryBackoff specifies the backoff strategy for retries
                  (exponential or fixed)
                enum:
                - exponential
                - fixed
                type: string
              retryDelay:
                default: 30s
                description: RetryDelay specifies the initial delay between retries
                  (e.g., "30s", "1m")
                pattern: ^([0-9]+(s|m|h))+$
                type: string
              schedule:
                description: |-
                  Schedule defines a cron schedule for automatic experiment execution
                  When set, the experiment will run automatically according to this schedule
                  Format follows standard cron syntax: "minute hour day-of-month month day-of-week"
                  Special strings: @hourly, @daily, @weekly, @monthly, @yearly
                  Examples: "0 2 * * *" (daily at 2am), "*/30 * * * *" (every 30 minutes), "@hourly"
                  If not set, the experiment runs once immediately after creation
                type: string
              selector:
                additionalProperties:
                  type: string
                description: Selector specifies the label selector for target resources
                minProperties: 1
                type: object
            required:
            - action
            - namespace
            - selector
            type: object
          status:
            description: status defines the observed state of ChaosExperiment
            properties:
              affectedPods:
                description: |-
                  AffectedPods tracks pods that have ephemeral containers injected by this experiment
                  Used for cleanup when the experiment completes (pod-cpu-stress, pod-memory-stress)
                  Format: "namespace/podName:containerName"
                items:
                  type: string
                type: array
              completedAt:
                description: CompletedAt indicates when the experiment completed (either
                  by duration or manually)
                format: date-time
                type: string
              cordonedNodes:
                description: |-
                  CordonedNodes tracks nodes that were cordoned by this experiment
                  Used for auto-uncordon when the experiment completes
                items:
                  type: string
                type: array
              lastError:
                description: LastError stores the last error message encountered
                type: string
              lastRunTime:
                description: LastRunTime indicates when the experiment was last executed
                format: date-time
                type: string
              lastScheduledTime:
                description: |-
                  LastScheduledTime indicates when the scheduled experiment was last triggered
                  Only set when spec.schedule is defined
                format: date-time
                type: string
              message:
                description: Message provides human-readable status information
                type: string
              nextRetryTime:
                description: NextRetryTime indicates when the next retry will be attempted
                format: date-time
                type: string
              nextScheduledTime:
                description: |-
                  NextScheduledTime indicates when the next scheduled run will occur
                  Only set when spec.schedule is defined
                format: date-time
                type: string
              phase:
                description: Phase represents the current state of the experiment
                enum:
                - Pending
                - Running
                - Completed
                - Failed
                type: string
              retryCount:
                description: RetryCount tracks the current number of retry attempts
                type: integer
              startTime:
                description: StartTime indicates when the experiment started running
                format: date-time
                type: string
            type: object
        required:
        - spec
        type: object
    served: true
    storage: true
    subresources:
      status: {}
